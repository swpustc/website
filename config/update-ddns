#!/bin/bash
cd "`dirname $0`/../"
## Work Directory: /home/git/html/
## User: git

## Generate Table
if host mirrors.lug >/tmp/ddns.tmp; then
  UTC="`date +%s`"
  WEK="`date --date=@$UTC -R | awk -F, '{print $1}'`-ddns"
  TME="`date --date=@$UTC '+%F %T'`"
  echo "<article data-categories=\"$WEK\"><div class=\"one-fourth time\">$TME</div><div class=\"three-fourth last vpn1\">`cat /tmp/ddns.tmp | awk 'NR==1'`</div><hr class=\"clear\"/></article>" >>/var/log/ddns.log
elif host mirrors.lug >/tmp/ddns.tmp; then
  UTC="`date +%s`"
  WEK="`date --date=@$UTC -R | awk -F, '{print $1}'`-ddns"
  TME="`date --date=@$UTC '+%F %T'`"
  echo "<article data-categories=\"$WEK\"><div class=\"one-fourth time\">$TME</div><div class=\"three-fourth last vpn2\">`cat /tmp/ddns.tmp | awk 'NR==1'`</div><hr class=\"clear\"/></article>" >>/var/log/ddns.log
elif host mirrors.lug >/tmp/ddns.tmp; then
  UTC="`date +%s`"
  WEK="`date --date=@$UTC -R | awk -F, '{print $1}'`-ddns"
  TME="`date --date=@$UTC '+%F %T'`"
  echo "<article data-categories=\"$WEK\"><div class=\"one-fourth time\">$TME</div><div class=\"three-fourth last vpn3\">`cat /tmp/ddns.tmp | awk 'NR==1'`</div><hr class=\"clear\"/></article>" >>/var/log/ddns.log
elif host mirrors.lug >/tmp/ddns.tmp; then
  UTC="`date +%s`"
  WEK="`date --date=@$UTC -R | awk -F, '{print $1}'`-ddns"
  TME="`date --date=@$UTC '+%F %T'`"
  echo "<article data-categories=\"$WEK\"><div class=\"one-fourth time\">$TME</div><div class=\"three-fourth last vpn4\">`cat /tmp/ddns.tmp | awk 'NR==1'`</div><hr class=\"clear\"/></article>" >>/var/log/ddns.log
elif host mirrors.lug >/tmp/ddns.tmp; then
  UTC="`date +%s`"
  WEK="`date --date=@$UTC -R | awk -F, '{print $1}'`-ddns"
  TME="`date --date=@$UTC '+%F %T'`"
  echo "<article data-categories=\"$WEK\"><div class=\"one-fourth time\">$TME</div><div class=\"three-fourth last vpn5\">`cat /tmp/ddns.tmp | awk 'NR==1'`</div><hr class=\"clear\"/></article>" >>/var/log/ddns.log
else
  UTC="`date +%s`"
  WEK="`date --date=@$UTC -R | awk -F, '{print $1}'`-ddns"
  TME="`date --date=@$UTC '+%F %T'`"
  echo "<article data-categories=\"$WEK\"><div class=\"one-fourth time\">$TME</div>`/home/git/update-ddns 1``/home/git/update-ddns 2``/home/git/update-ddns 3`<hr class=\"clear\"/></article>" >>/var/log/ddns.log
fi
tail -n 1008 /var/log/ddns.log >/dev/null

## Generate ddns-log.html
### /tmp/ddns-log.html
     UTC1="`date +%s`"
let "UTC2=$UTC1-86400"
let "UTC3=$UTC2-86400"
let "UTC4=$UTC3-86400"
let "UTC5=$UTC4-86400"
let "UTC6=$UTC5-86400"
let "UTC7=$UTC6-86400"
DAT1="`date --date=@$UTC1 +%m\\\/%d`"
DAT2="`date --date=@$UTC2 +%m\\\/%d`"
DAT3="`date --date=@$UTC3 +%m\\\/%d`"
DAT4="`date --date=@$UTC4 +%m\\\/%d`"
DAT5="`date --date=@$UTC5 +%m\\\/%d`"
DAT6="`date --date=@$UTC6 +%m\\\/%d`"
DAT7="`date --date=@$UTC7 +%m\\\/%d`"
WEK1="`date --date=@$UTC1 -R | awk -F, '{print $1}'`-ddns"
WEK2="`date --date=@$UTC2 -R | awk -F, '{print $1}'`-ddns"
WEK3="`date --date=@$UTC3 -R | awk -F, '{print $1}'`-ddns"
WEK4="`date --date=@$UTC4 -R | awk -F, '{print $1}'`-ddns"
WEK5="`date --date=@$UTC5 -R | awk -F, '{print $1}'`-ddns"
WEK6="`date --date=@$UTC6 -R | awk -F, '{print $1}'`-ddns"
WEK7="`date --date=@$UTC7 -R | awk -F, '{print $1}'`-ddns"
TME="`date --date=@$UTC1 '+%F %T'`"
cat ddns-log_header.shtml | tee /tmp/ddns-log.html    >/dev/null
cat header.shtml          | sed "s/<!--CURRENT:DDNS-->/<li class=\"current\">/g" \
                          | sed "s/<!--CURRENT:STATUS-->/<li class=\"current\">/g" \
                          | sed "s/<!--CURRENT:[^>]*-->/<li>/g" \
                          | tee /tmp/ddns-log.html -a >/dev/null
cat ddns-log_body.shtml   | sed "s/<!--UPDATETIME-->/$TME/g" \
                          | sed "s/<!--DATA-CATEGORIES:TIME:1-->/<a data-categories=\"$WEK1\">$DAT1<\/a>/g" \
                          | sed "s/<!--DATA-CATEGORIES:TIME:2-->/<a data-categories=\"$WEK2\">$DAT2<\/a>/g" \
                          | sed "s/<!--DATA-CATEGORIES:TIME:3-->/<a data-categories=\"$WEK3\">$DAT3<\/a>/g" \
                          | sed "s/<!--DATA-CATEGORIES:TIME:4-->/<a data-categories=\"$WEK4\">$DAT4<\/a>/g" \
                          | sed "s/<!--DATA-CATEGORIES:TIME:5-->/<a data-categories=\"$WEK5\">$DAT5<\/a>/g" \
                          | sed "s/<!--DATA-CATEGORIES:TIME:6-->/<a data-categories=\"$WEK6\">$DAT6<\/a>/g" \
                          | sed "s/<!--DATA-CATEGORIES:TIME:7-->/<a data-categories=\"$WEK7\">$DAT7<\/a>/g" \
                          | tee /tmp/ddns-log.html -a >/dev/null
cat /var/log/ddns.log     | tee /tmp/ddns-log.html -a >/dev/null
echo "</section></div>"   | tee /tmp/ddns-log.html -a >/dev/null
cat footer.shtml          | tee /tmp/ddns-log.html -a >/dev/null
cat ddns-log_footer.shtml | tee /tmp/ddns-log.html -a >/dev/null

### status/ddns-log-static.html
cat ddns-log_header.shtml | tee status/ddns-log-static.html    >/dev/null
cat header.shtml          | sed "s/<!--CURRENT:DDNS-->/<li class=\"current\">/g" \
                          | sed "s/<!--CURRENT:STATUS-->/<li class=\"current\">/g" \
                          | sed "s/<!--CURRENT:[^>]*-->/<li>/g" \
                          | tee status/ddns-log-static.html -a >/dev/null
cat ddns-log_body.shtml   | sed "s/<!--UPDATETIME-->/$TME/g" \
                          | sed "s/<!--DATA-CATEGORIES:TIME:1-->/<a data-categories=\"$WEK1\">$DAT1<\/a>/g" \
                          | sed "s/<!--DATA-CATEGORIES:TIME:2-->/<a data-categories=\"$WEK2\">$DAT2<\/a>/g" \
                          | sed "s/<!--DATA-CATEGORIES:TIME:3-->/<a data-categories=\"$WEK3\">$DAT3<\/a>/g" \
                          | sed "s/<!--DATA-CATEGORIES:TIME:4-->/<a data-categories=\"$WEK4\">$DAT4<\/a>/g" \
                          | sed "s/<!--DATA-CATEGORIES:TIME:5-->/<a data-categories=\"$WEK5\">$DAT5<\/a>/g" \
                          | sed "s/<!--DATA-CATEGORIES:TIME:6-->/<a data-categories=\"$WEK6\">$DAT6<\/a>/g" \
                          | sed "s/<!--DATA-CATEGORIES:TIME:7-->/<a data-categories=\"$WEK7\">$DAT7<\/a>/g" \
                          | tee status/ddns-log-static.html -a >/dev/null
echo "</section></div>"   | tee status/ddns-log-static.html -a >/dev/null
cat footer.shtml          | tee status/ddns-log-static.html -a >/dev/null
cat ddns-log_footer.shtml | tee status/ddns-log-static.html -a >/dev/null
