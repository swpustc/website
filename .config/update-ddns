#!/bin/bash
if [ "startup"x == "$1"x ] ;then
  echo '<html><head><meta charset="utf-8"><title>DDNS Logs</title></head><body>' >/tmp/ddns
  echo "<p>Update time:  `date \"+%F %T\"`</p>" >>/tmp/ddns
  echo '<table><thead><table width=60% border=1><tr>
<th style="width:25%;">Update time</th>
<th style="width:25%;">Oray swpustc</th>
<th style="width:25%;">Oray swp543210</th>
<th style="width:25%;">Oray router-swp</th>
</tr></thead><tbody>' >>/tmp/ddns
  chown git. /tmp/ddns
  chmod 644 /tmp/ddns
else
  if host mirrors.lug >/tmp/ddns.tmp; then
    echo "<tr><td>`date \"+%F %T\"`</td><td colspan='3' style=\"background-color: #FFFF80\">`cat /tmp/ddns.tmp | awk 'NR==1'` (1)</td></tr>" >>/tmp/ddns
  elif host mirrors.lug >/tmp/ddns.tmp; then
    echo "<tr><td>`date \"+%F %T\"`</td><td colspan='3' style=\"background-color: #FFDF80\">`cat /tmp/ddns.tmp | awk 'NR==1'` (2)</td></tr>" >>/tmp/ddns
  elif host mirrors.lug >/tmp/ddns.tmp; then
    echo "<tr><td>`date \"+%F %T\"`</td><td colspan='3' style=\"background-color: #FFBF80\">`cat /tmp/ddns.tmp | awk 'NR==1'` (3)</td></tr>" >>/tmp/ddns
  elif host mirrors.lug >/tmp/ddns.tmp; then
    echo "<tr><td>`date \"+%F %T\"`</td><td colspan='3' style=\"background-color: #FF9F80\">`cat /tmp/ddns.tmp | awk 'NR==1'` (4)</td></tr>" >>/tmp/ddns
  elif host mirrors.lug >/tmp/ddns.tmp; then
    echo "<tr><td>`date \"+%F %T\"`</td><td colspan='3' style=\"background-color: #FF8080\">`cat /tmp/ddns.tmp | awk 'NR==1'` (5)</td></tr>" >>/tmp/ddns
  else
    echo "<tr><td>`date \"+%F %T\"`</td>`/home/git/update-ddns 1``/home/git/update-ddns 2``/home/git/update-ddns 3`</tr>" >>/tmp/ddns
  fi
  cat /tmp/ddns >/tmp/ddns.tmp
  sed -e "2 s/^<p>Update time:\(.*\)/<p>Update time:  `date \"+%F %T\"`<\/p>/g" /tmp/ddns.tmp | tee /tmp/ddns
fi
